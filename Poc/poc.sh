#! /bin/sh
gcc --static poc.c -o poc
cp poc initramfs/
cd initramfs
find . | cpio -o --format=newc > ../initramfs.cpio.gz
cd ../

qemu-system-x86_64 \
-m 1G \
-kernel ../ramfs/bzImage \
-initrd  ./initramfs.cpio.gz \
-nographic \
-append "console=ttyS0 root=/dev/sda rw nokaslr quiet" \
-netdev user,id=t0, -device e1000,netdev=t0,id=nic0 \
-cpu kvm64,+smep,+smap \
-gdb tcp::10086
